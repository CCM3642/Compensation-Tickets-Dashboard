<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>نظام متابعة التعويضات - Crispy Chicken</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body { font-family: Arial; background: #f0f2f5; margin:0; padding:20px; }
  h1,h2 { text-align:center; color:#ff9800; }
  table { width:100%; border-collapse: collapse; background:#fff; box-shadow:0 2px 6px rgba(0,0,0,0.1);}
  th, td { padding:8px 12px; border:1px solid #ddd; vertical-align:middle; }
  th { background:#ff9800; color:#fff; position:sticky; top:0; }
  tr:hover { background:#fff3e0; }
  .action-buttons { display:flex; gap:5px; opacity:0; transition:opacity 0.3s ease; }
  tr:hover .action-buttons { opacity:1; }
  button { padding:5px 10px; border:none; border-radius:5px; cursor:pointer; transition:transform 0.2s; }
  button:hover { transform:scale(1.1); }
  .edit { background:#4caf50;color:#fff; }
  .add { background:#2196f3;color:#fff; }
  .whatsapp { background:#25D366;color:#fff; }
  .email { background:#f44336;color:#fff; }
  .close { background:#9e9e9e;color:#fff; }
  input, select { width:100%; padding:4px; box-sizing:border-box; }
  .evidence img,.evidence video { max-width:80px; max-height:60px; }
  .dashboard { display:flex; flex-wrap:wrap; justify-content:space-around; margin:20px 0; }
  .card { background:#fff; padding:15px; margin:10px; border-radius:8px; flex:1; min-width:150px; text-align:center; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
  .chart-container { width:100%; max-width:900px; margin:20px auto; background:#fff; padding:15px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
</style>
</head>
<body>

<h1>نظام متابعة التعويضات - Crispy Chicken</h1>

<!-- لوحة البيانات Dashboard -->
<div class="dashboard">
  <div class="card">
    <h3 id="totalOrders">0</h3>
    <p>إجمالي الطلبات</p>
  </div>
  <div class="card">
    <h3 id="openOrders">0</h3>
    <p>الطلبات المفتوحة</p>
  </div>
  <div class="card">
    <h3 id="closedOrders">0</h3>
    <p>الطلبات المغلقة</p>
  </div>
  <div class="card">
    <h3 id="totalComp">0 AED</h3>
    <p>إجمالي التعويضات</p>
  </div>
</div>

<!-- الجدول الرئيسي -->
<table id="compTable">
  <thead>
    <tr>
      <th>Order ID</th>
      <th>Date</th>
      <th>Branch</th>
      <th>Platform</th>
      <th>Issue</th>
      <th>Evidence</th>
      <th>Status</th>
      <th>Compensation</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>

<!-- الرسم البياني -->
<div class="chart-container">
  <canvas id="compChart"></canvas>
</div>

<!-- زر طباعة التقرير -->
<div style="text-align:center; margin:20px;">
  <button class="add" onclick="window.print()">طباعة التقرير</button>
</div>

<script>
  // بيانات أولية كمثال
  let compData = [
    {orderId:'127822175',date:'9/2/2025',branch:'Hamdan',platform:'Careem',issue:'Wrong item',evidence:'',status:'Open',comp:12.99},
    {orderId:'127822223',date:'9/2/2025',branch:'Al Barsha',platform:'Careem',issue:'Food not edible',evidence:'https://files.fm/u/pk8m5nzdj2',status:'Open',comp:21.70},
    {orderId:'127841536',date:'9/2/2025',branch:'Hamdan',platform:'Careem',issue:'Missing side item',evidence:'https://files.fm/u/pk8m5nzdj2',status:'Open',comp:6.00},
    // يمكن إضافة باقي البيانات هنا
  ];

  // حفظ واسترجاع البيانات
  if(localStorage.getItem('compData')) compData=JSON.parse(localStorage.getItem('compData'));
  function saveData(){ localStorage.setItem('compData',JSON.stringify(compData)); renderDashboard(); renderChart(); }

  // إنشاء الجدول
  const tbody = document.querySelector('#compTable tbody');
  function renderTable(){
    tbody.innerHTML='';
    compData.forEach((row,i)=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`
        <td>${row.orderId}</td>
        <td>${row.date}</td>
        <td>${row.branch}</td>
        <td>${row.platform}</td>
        <td><input type="text" value="${row.issue}"></td>
        <td class="evidence">
          ${row.evidence ? `<a href="${row.evidence}" target="_blank">عرض</a>`:
          `<select class="evidenceSelect">
            <option value="">لا يوجد إثبات</option>
            <option value="image">صورة</option>
            <option value="video">فيديو</option>
          </select>`}
        </td>
        <td><select class="statusSelect">
          <option value="Open" ${row.status==='Open'?'selected':''}>Open</option>
          <option value="Closed" ${row.status==='Closed'?'selected':''}>Closed</option>
        </select></td>
        <td><input type="number" value="${row.comp}" step="0.01"></td>
        <td>
          <div class="action-buttons">
            <button class="edit">Edit</button>
            <button class="whatsapp">WhatsApp</button>
            <button class="email">Email</button>
            <button class="close">Close</button>
          </div>
        </td>
      `;
      tbody.appendChild(tr);

      // حفظ التعديلات مباشرة
      tr.querySelector('input[type=text]').addEventListener('change', e=>{ row.issue=e.target.value; saveData(); });
      tr.querySelector('input[type=number]').addEventListener('change', e=>{ row.comp=parseFloat(e.target.value); saveData(); });
      tr.querySelector('.statusSelect').addEventListener('change', e=>{ row.status=e.target.value; saveData(); });
      tr.querySelector('.evidenceSelect')?.addEventListener('change', e=>{ row.evidence=e.target.value; saveData(); renderTable(); });

      // أزرار تفاعلية
      tr.querySelector('.edit').addEventListener('click', ()=>alert(`Edit: ${row.orderId}`));
      tr.querySelector('.whatsapp').addEventListener('click', ()=>alert(`Send WhatsApp: ${row.orderId}`));
      tr.querySelector('.email').addEventListener('click', ()=>alert(`Send Email: ${row.orderId}`));
      tr.querySelector('.close').addEventListener('click', ()=>{ row.status='Closed'; saveData(); renderTable(); });
    });
  }

  // Dashboard
  function renderDashboard(){
    document.getElementById('totalOrders').innerText=compData.length;
    document.getElementById('openOrders').innerText=compData.filter(r=>r.status==='Open').length;
    document.getElementById('closedOrders').innerText=compData.filter(r=>r.status==='Closed').length;
    document.getElementById('totalComp').innerText=compData.reduce((a,b)=>a+b.comp,0).toFixed(2)+' AED';
  }

  // الرسم البياني
  const ctx=document.getElementById('compChart').getContext('2d');
  let compChart;
  function renderChart(){
    const branchTotals={};
    compData.forEach(r=>branchTotals[r.branch]=(branchTotals[r.branch]||0)+r.comp);
    const labels=Object.keys(branchTotals);
    const data=Object.values(branchTotals);
    if(compChart) compChart.destroy();
    compChart=new Chart(ctx,{type:'bar',data:{labels,datasets:[{label:'إجمالي التعويض (AED)',data,backgroundColor:'#ff9800'}]},options:{responsive:true,plugins:{legend:{display:false}}}});
  }

  // البدء
  renderTable();
  renderDashboard();
  renderChart();

</script>

</body>
</html>
