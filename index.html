<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Crispy Chicken - Complaints Dashboard</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<style>
  :root {
    --crispy-red:#d32f2f; --crispy-dark:#b71c1c; --crispy-light:#ffcdd2; --bg-light:#fafafa;
    --text-primary:#333; --text-secondary:#666; --noon-color:#ffb800; --careem-color:#00a86b;
  }
  body{font-family:system-ui,sans-serif;background:var(--bg-light);color:var(--text-primary);margin:0;}
  .navbar{background:linear-gradient(135deg,var(--crispy-red),var(--crispy-dark));padding:12px 0;position:sticky;top:0;z-index:1030;}
  .navbar-brand{color:#fff;font-weight:800;}
  .container-page{max-width:1280px;margin:0 auto;padding:20px;}
  .dashboard-stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:16px;margin-bottom:24px;}
  .stat-card{background:#fff;border-radius:14px;padding:20px;box-shadow:0 4px 14px rgba(0,0,0,.06);border-left:6px solid transparent;}
  .stat-card.total{border-color:var(--crispy-red);}
  .stat-card.open{border-color:#0d6efd;}
  .stat-card.sent{border-color:#f59f00;}
  .stat-card.closed{border-color:#2fb344;}
  .stat-card h3{margin:4px 0 2px;font-weight:800;}
  .stat-card p{margin:0;color:var(--text-secondary);font-weight:600;}
  .platform-cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:16px;margin-bottom:24px;}
  .platform-card{background:#fff;border-radius:16px;padding:22px;box-shadow:0 6px 16px rgba(0,0,0,.08);text-align:center;border:3px solid transparent;}
  .platform-card.noon{border-color:var(--noon-color);}
  .platform-card.careem{border-color:var(--careem-color);}
  .tickets-section{background:#fff;border-radius:18px;padding:22px;box-shadow:0 8px 20px rgba(0,0,0,.08);margin-bottom:28px;}
  .table-responsive{border-radius:14px;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,.06);}
  thead th{background:var(--crispy-light);color:var(--crispy-dark);font-weight:800;border:none !important;}
  tbody tr:hover{background:rgba(211,47,47,.05);}
  .truncate{max-width:360px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
  .issue-cell{position:relative;}
  .issue-expand{appearance:none;border:none;background:transparent;text-decoration:underline;padding:0;margin-left:6px;cursor:pointer;font-size:.85rem;}
  .action-buttons{visibility:hidden;opacity:0;display:flex;gap:6px;transition:opacity .3s ease;}
  tbody tr:hover .action-buttons{visibility:visible;opacity:1;}
  .action-btn{padding:6px 10px;border-radius:8px;border:none;font-weight:700;color:#fff;}
  .btn-edit{background:#ffc107;color:#000;}
  .btn-email{background:#17a2b8;}
  .btn-whatsapp{background:#25D366;}
  .btn-close{background:#28a745;}
  @media (max-width:768px){.truncate{max-width:160px;}}
</style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark">
<div class="container-page">
  <a class="navbar-brand" href="#"><i class="bi bi-fire"></i> Crispy Chicken • Complaints</a>
</div>
</nav>
<main class="container-page">
<section class="dashboard-stats">
  <div class="stat-card total"><h3 id="totalTickets">0</h3><p>Total Tickets</p></div>
  <div class="stat-card open"><h3 id="openTickets">0</h3><p>Open Tickets</p></div>
  <div class="stat-card sent"><h3 id="sentTickets">0</h3><p>Sent Tickets</p></div>
  <div class="stat-card closed"><h3 id="closedTickets">0</h3><p>Closed Tickets</p></div>
</section>
<section>
  <h2 class="h5 fw-bold" style="color: var(--crispy-dark)">Platform Distribution</h2>
  <div class="platform-cards">
    <div class="platform-card noon">
      <i class="bi bi-cart-check fs-1 d-block mb-2" style="color: var(--noon-color)"></i>
      <h3 id="noonCount">0</h3>
      <p>Noon Orders</p>
      <div class="fw-bold" id="noonPercentage">0%</div>
    </div>
    <div class="platform-card careem">
      <i class="bi bi-car-front fs-1 d-block mb-2" style="color: var(--careem-color)"></i>
      <h3 id="careemCount">0</h3>
      <p>Careem Orders</p>
      <div class="fw-bold" id="careemPercentage">0%</div>
    </div>
  </div>
</section>
<section class="tickets-section">
  <div class="d-flex justify-content-between mb-3 align-items-center">
    <h2 class="h5"><i class="bi bi-list-task"></i> Complaint Tickets</h2>
    <div class="d-flex gap-2 flex-wrap">
      <button class="btn btn-danger" onclick="openAddTicketModal()"><i class="bi bi-plus-circle"></i> Add Ticket</button>
      <button class="btn btn-outline-secondary" onclick="resetData()"><i class="bi bi-arrow-clockwise"></i> Reset</button>
    </div>
  </div>
  <div id="ticketsContainer"></div>
</section>
</main>

<!-- Modals -->
<div class="modal fade" id="addTicketModal" tabindex="-1" aria-hidden="true">
<div class="modal-dialog modal-lg">
<div class="modal-content">
<div class="modal-header text-white" style="background: linear-gradient(135deg, var(--crispy-red), var(--crispy-dark));">
<h5 class="modal-title"><i class="bi bi-plus-circle"></i> <span id="modalTitle">Add Ticket</span></h5>
<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
</div>
<div class="modal-body">
<form id="addTicketForm">
<input type="hidden" id="editingId" value="">
<div class="row g-3">
<div class="col-md-6">
<label class="form-label">Order ID</label>
<input class="form-control" id="orderId" required />
</div>
<div class="col-md-6">
<label class="form-label">Order Date</label>
<input type="date" class="form-control" id="orderDate" required />
</div>
<div class="col-md-6">
<label class="form-label">Branch</label>
<select class="form-select" id="branch" required>
<option value="">Select Branch</option>
<option>Crispy Chicken Khalidiya</option>
<option>Crispy Chicken Muroor</option>
<option>Crispy Chicken Shabiya 11</option>
<option>Crispy Chicken Al Barsha</option>
<option>Crispy Chicken Al Satwa</option>
<option>Crispy Chicken Electra</option>
<option>Crispy Chicken Hamdan</option>
</select>
</div>
<div class="col-md-6">
<label class="form-label">Platform</label>
<select class="form-select" id="platform" required>
<option value="">Select Platform</option>
<option>Noon</option>
<option>Careem</option>
</select>
</div>
<div class="col-12">
<label class="form-label">Issue Description</label>
<textarea id="issue" class="form-control autogrow" placeholder="Describe issue…" required></textarea>
</div>
<div class="col-md-6">
<label class="form-label">Compensation (AED)</label>
<input type="number" min="0" step="0.01" class="form-control" id="compensation" required />
</div>
</div>
<div class="mt-3">
<button class="btn btn-danger w-100 fw-bold" type="submit"><i class="bi bi-check-circle"></i> Save</button>
</div>
</form>
</div>
</div>
</div>
</div>

<div class="modal fade" id="issueModal" tabindex="-1" aria-hidden="true">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header" style="background: linear-gradient(135deg, var(--crispy-red), var(--crispy-dark));">
<h5 class="modal-title text-white"><i class="bi bi-chat-square-text"></i> Issue Details</h5>
<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
</div>
<div class="modal-body">
<p id="issueFullText"></p>
</div>
</div>
</div>
</div>

<div id="notification" class="notification" style="position:fixed;top:20px;right:20px;padding:14px 18px;background:#fff;border-left:5px solid var(--crispy-red);border-radius:12px;box-shadow:0 10px 26px rgba(0,0,0,.15);z-index:2000;transform:translateX(130%);transition:transform .45s;">Action completed</div>

<footer class="text-center py-4 mt-4 text-white" style="background: var(--crispy-dark); border-radius:18px 18px 0 0;">
<small>&copy; 2025 Crispy Chicken Delivery Management System</small>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
let tickets = JSON.parse(localStorage.getItem('crispyTickets'))||[];
let filteredTickets = [...tickets];

function saveToStorage(){localStorage.setItem('crispyTickets',JSON.stringify(tickets));}
function showNotification(msg,type='success'){const n=document.getElementById('notification');n.textContent=msg;n.style.transform='translateX(0)';setTimeout(()=>n.style.transform='translateX(130%)',2600);}
function escapeHtml(s=''){return s.replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[c]));}
function autogrow(el){el.style.height='auto';el.style.height=el.scrollHeight+'px';}

function renderTickets(){
  const container = document.getElementById('ticketsContainer');
  if(filteredTickets.length===0){container.innerHTML='<div class="text-center p-5 border rounded-3 bg-light"><i class="bi bi-inbox fs-1 d-block mb-3 text-secondary"></i><h3 class="h6 fw-bold">No tickets found</h3></div>';return;}
  let html='<div class="table-responsive"><table class="table table-hover align-middle mb-0"><thead><tr><th>Order ID</th><th>Order Date</th><th>Branch</th><th>Platform</th><th>Issue</th><th>Compensation</th><th>Status</th><th>Actions</th></tr></thead><tbody>';
  filteredTickets.forEach(t=>{
    const issueShort='<span class="truncate">'+escapeHtml(t.issue)+'</span> <button class="issue-expand" onclick="openIssueModal('+t.id+')">View</button>';
    html+='<tr><td><strong>'+t.orderId+'</strong></td><td>'+t.orderDate+'</td><td>'+t.branch+'</td><td>'+t.platform+'</td><td class="issue-cell">'+issueShort+'</td><td>AED '+t.compensation.toFixed(2)+'</td><td>'+t.status+'</td><td><div class="action-buttons"><button class="action-btn btn-whatsapp" onclick="sendWhatsApp('+t.id+')"><i class="bi bi-whatsapp"></i></button><button class="action-btn btn-email" onclick="sendEmail('+t.id+')"><i class="bi bi-envelope"></i></button><button class="action-btn btn-edit" onclick="editTicket('+t.id+')"><i class="bi bi-pencil"></i></button><button class="action-btn btn-close" onclick="closeTicket('+t.id+')"><i class="bi bi-check2-circle"></i></button></div></td></tr>';
  });
  html+='</tbody></table></div>';
  container.innerHTML=html;
  updateStats();
  updatePlatformStats();
}

function updateStats(){
  const total=tickets.length;
  const open=tickets.filter(t=>t.status==='Open').length;
  const sent=tickets.filter(t=>t.status==='Sent').length;
  const closed=tickets.filter(t=>t.status==='Closed').length;
  document.getElementById('totalTickets').textContent=total;
  document.getElementById('openTickets').textContent=open;
  document.getElementById('sentTickets').textContent=sent;
  document.getElementById('closedTickets').textContent=closed;
}

function updatePlatformStats(){
  const total=tickets.length||1;
  const noon=tickets.filter(t=>t.platform==='Noon').length;
  const careem=tickets.filter(t=>t.platform==='Careem').length;
  document.getElementById('noonCount').textContent=noon;
  document.getElementById('careemCount').textContent=careem;
  document.getElementById('noonPercentage').textContent=((noon/total)*100).toFixed(1)+'%';
  document.getElementById('careemPercentage').textContent=((careem/total)*100).toFixed(1)+'%';
}

function openAddTicketModal(){
  document.getElementById('modalTitle').textContent='Add Ticket';
  document.getElementById('addTicketForm').reset();
  document.getElementById('editingId').value='';
  const modal=new bootstrap.Modal(document.getElementById('addTicketModal'));
  modal.show();
}

function editTicket(id){
  const t=tickets.find(x=>x.id===id);
  if(!t)return;
  document.getElementById('modalTitle').textContent='Edit Ticket';
  document.getElementById('editingId').value=t.id;
  document.getElementById('orderId').value=t.orderId;
  document.getElementById('orderDate').value=t.orderDate;
  document.getElementById('branch').value=t.branch;
  document.getElementById('platform').value=t.platform;
  document.getElementById('issue').value=t.issue;
  document.getElementById('compensation').value=t.compensation;
  autogrow(document.getElementById('issue'));
  const modal=new bootstrap.Modal(document.getElementById('addTicketModal'));
  modal.show();
}

function openIssueModal(id){
  const t=tickets.find(x=>x.id===id);
  if(!t)return;
  document.getElementById('issueFullText').textContent=t.issue;
  const modal=new bootstrap.Modal(document.getElementById('issueModal'));
  modal.show();
}

function closeTicket(id){
  const t=tickets.find(x=>x.id===id);
  if(!t)return;
  t.status='Closed';
  saveToStorage();
  renderTickets();
  showNotification('Ticket closed successfully');
}

function sendWhatsApp(id){
  const t=tickets.find(x=>x.id===id);
  if(!t)return;
  const msg=`Hello, regarding Order ID ${t.orderId}, issue: ${t.issue}. Compensation: AED ${t.compensation.toFixed(2)}.`;
  window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`,'_blank');
}

function sendEmail(id){
  const t=tickets.find(x=>x.id===id);
  if(!t)return;
  const subject=`Crispy Chicken Ticket ${t.orderId}`;
  const body=`Issue: ${t.issue}\nCompensation: AED ${t.compensation.toFixed(2)}`;
  window.open(`mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`);
}

function resetData(){if(confirm('Reset all tickets?')){tickets=[];saveToStorage();renderTickets();showNotification('All data reset');}}

document.getElementById('addTicketForm').addEventListener('submit',function(e){
  e.preventDefault();
  const id=Number(document.getElementById('editingId').value);
  const orderId=document.getElementById('orderId').value.trim();
  const orderDate=document.getElementById('orderDate').value;
  const branch=document.getElementById('branch').value;
  const platform=document.getElementById('platform').value;
  const issue=document.getElementById('issue').value.trim();
  const compensation=Number(document.getElementById('compensation').value);
  if(!orderId||!orderDate||!branch||!platform||!issue||isNaN(compensation)) return;
  if(id){ // edit
    const t=tickets.find(x=>x.id===id);
    Object.assign(t,{orderId,orderDate,branch,platform,issue,compensation});
    showNotification('Ticket updated successfully');
  }else{
    tickets.push({id:Date.now(),orderId,orderDate,branch,platform,issue,compensation,status:'Open'});
    showNotification('Ticket added successfully');
  }
  saveToStorage();
  renderTickets();
  const modalEl=document.getElementById('addTicketModal');
  const modal=bootstrap.Modal.getInstance(modalEl);
  modal.hide();
});

document.querySelectorAll('.autogrow').forEach(el=>el.addEventListener('input',()=>autogrow(el)));

renderTickets();
</script>
</body>
</html>
